{% extends "base.html" %}

{% block content %}

    <h1>Job: {{ job.name }}</h1>
    <div class="col-md-3">Job id:</div>
    <div class="col-md-9">{{ job.pk }}</div>
    <div class="col-md-3">Number of features:</div>
    <div class="col-md-9">{{ job.feature_set.count }}</div>
    <div class="col-md-3">Target mean</div>
    <div class="col-md-9">{% if job.query_target_mean %}Will be queried {% else %}{{ job.target_mean }}{% endif %}</div>
    <div class="col-md-3">Estimated costs:</div>
    <div class="col-md-9">${{ job.estimate_costs }}</div>

    <form classt="form-inline" action="{{ links.edit }}">
        <!-- does not work yet (data set) <button type="submit" class="btn btn-default">Edit</button> -->
    </form>
<div class="col-md-12">
        <button id="btn-start" class="btn btn-primary">Start</button>

    </div>

    <div class="col-md-6">
    <div id="div-message" class="alert-info"></div>
    </div>


{% endblock %}

{% block javascript %}
    <script>
        function onStarted(data) {
            if (data.success === 'success'){
                var msg = data.message;
                msg += "<a href="+data.links.job_status+">Click here to check the status of this job.</a>";
                $('#div-message').html(msg).show();
            }
        }

        $(document).ready(function () {
            $('#div-message').hide();

            $('#btn-start').click(function() {
                var url = "{{ links.start }}";
                $.ajax({url: url, contentType: "application/json", type: 'POST', data: {csrfmiddlewaretoken: '{{ csrf_token }}'} })
                        .done(function (data) {
                            onStarted(data);
                        })
                        .fail(function () {
                            alert("error");
                        })
{#                        .always(function () {#}
{#                            alert("complete");#}
{#                        });#}
            });
        });
    </script>
{% endblock %}